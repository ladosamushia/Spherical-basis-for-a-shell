% mnras_template.tex 
%
% LaTeX template for creating an MNRAS paper
%
% v3.0 released 14 May 2015
% (version numbers match those of mnras.cls)
%
% Copyright (C) Royal Astronomical Society 2015
% Authors:
% Keith T. Smith (Royal Astronomical Society)

% Change log
%
% v3.0 May 2015
%    Renamed to match the new package name
%    Version number matches mnras.cls
%    A few minor tweaks to wording
% v1.0 September 2013
%    Beta testing only - never publicly released
%    First version: a simple (ish) template for creating an MNRAS paper

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Basic setup. Most papers should leave these options alone.
\documentclass[fleqn,usenatbib]{mnras}

% MNRAS is set in Times font. If you don't have this installed (most LaTeX
% installations will be fine) or prefer the old Computer Modern fonts, comment
% out the following line
\usepackage{newtxtext,newtxmath}
% Depending on your LaTeX fonts installation, you might get better results with one of these:
%\usepackage{mathptmx}
%\usepackage{txfonts}

% Use vector fonts, so it zooms properly in on-screen viewing software
% Don't change these lines unless you know what you are doing
\usepackage[T1]{fontenc}
\usepackage{ae,aecompl}


%%%%% AUTHORS - PLACE YOUR OWN PACKAGES HERE %%%%%

% Only include extra packages if you really need them. Common packages are:
\usepackage{graphicx}	% Including figure files
\usepackage{amsmath}	% Advanced maths commands
\usepackage{amssymb}	% Extra maths symbols

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%% AUTHORS - PLACE YOUR OWN COMMANDS HERE %%%%%

% Please keep new commands to a minimum, and use \newcommand not \def to avoid
% overwriting existing commands. Example:
%\newcommand{\pcm}{\,cm$^{-2}$}	% per cm-squared
\newcommand{\rmin}{r_\mathrm{min}}
\newcommand{\rmax}{r_\mathrm{max}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%% TITLE PAGE %%%%%%%%%%%%%%%%%%%

% Title of the paper, and the short title which is used in the headers.
% Keep the title short and informative.
\title[Basis for spherical shells]{Proper Fourier-Bessel decomposition formalism for cosmological fields in spherical shell}

% The list of authors, and the short list which is used in the headers.
% If you need two or more lines of authors, add an extra line using \newauthor
\author[First Author et al.]{
First Author,$^{1}$\thanks{E-mail: mn@ras.org.uk (KTS)}
Second Author$^{2}$
Third Author$^{2,3}$
and Fourth Author$^{3}$
\\
% List of institutions
$^{1}$ First institute\\
$^{2}$ Second institute\\
$^{3}$ Third institute
}

% These dates will be filled out by the publisher
% \date{Accepted XXX. Received YYY; in original form ZZZ}

% Enter the current year, for the copyright statements etc.
\pubyear{2019}

% Don't change these lines
\begin{document}
\label{firstpage}
\pagerange{\pageref{firstpage}--\pageref{lastpage}}
\maketitle

% Abstract of the paper
\begin{abstract}
\end{abstract}

% Select between one and six entries from the list of approved keywords.
% Don't make up new ones.
\begin{keywords}
methods: analytical -- methods: data analysis -- methods: numerical -- methods: statistical -- large-scale structure of Universe
\end{keywords}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%% BODY OF PAPER %%%%%%%%%%%%%%%%%%

\section{Introduction}
Cosmological fields are often analyzed in Fourier basis. This is convenient
because the distribution of matter in the Universe is initially very close to
Gaussian with different Fourier modes statistically independent form each other.
Although, gravitational instability couples initially independent Fourier modes
on smaller scales, on large scales, where the gravitational evolution is close
to linear, the Fourier modes remain uncorrelated.

Fourier bases depends on the geometry of the analyzed volume. For a cube with a
side length $L$ and  periodic boundary conditions the proper set of complete
orthogonal basis vectors is made of exponentials 

\begin{equation}
\label{eq:Fcube}
f_{l,m,n}(x,y,z)\propto e^{i\frac{2\pi}{L}\left(lx + my + nz\right)},
\end{equation}

where $l$, $m$, $n$ are integers and $x$, $y$, $z$ are Cartesian coordinates.

Inside of a sphere of size $R$, with zero boundary conditions on the outer
boundary and a restriction that the functions are finite everywhere inside, the
complete orthogonal basis is

\begin{equation}
\label{eq:Fsphere}
f_{\ell,m,n}(r,\theta,\phi) \propto j_\ell\left(\frac{k_{\ell,n}} {R}r\right)Y^\ell_m
(\theta,\phi).
\end{equation}

Here $j_\ell$ are spherical Bessel functions of the first kind, $Y^\ell_m$ are
the spherical harmonics, and $k_{\ell,n}$ is the n-th zero of the $\ell$-th
order spherical Bessel function. $r$, $\theta$, $\phi$ are spherical
coordinates, while $n$, $\ell$ and $m$ are integers satisfying $-\ell \leq m
\leq \ell$.

Real survey volumes are neither cubes nor spheres, but rather have a complicated
geometry. A standard practice is to embeds these volumes into a larger cube,
zero-pad the areas outside the actual observable volume, and Fourier decompose
the field in the basis of Eq.~(\ref{eq:Fcube}). Alternatively, one can use an
enclosing sphere and the basis of Eq.~(\ref{eq:Fsphere}).

The Cartesian basis is more convenient to compute and interpret and is more
frequently used in the analysis of galaxy clustering data. The spherical basis
of has the advantage that some of the relevant physics (e.g. redshift-space
distortions, redshift evolution) is better aligned with the coordinates.

In both cases we are using a larger than observed volume for Fourier
decomposition which gives rise to so called ``Window effects''. The basis
vectors are not orthogonal anymore. Since the decomposition volume is larger
than the observed volume there are too many basis vectors and not all of them
are independent. This affects large scales (comparable to the size of the
survey) more and correlates those modes even when they are Gaussian. If we
decomposed the distribution in true eigenvectors of the observed volume large
scale linear modes would be uncorrelated. Unfortunately, this is not possible
due to a complicated nature of visibility masks.

In this paper we propose a method that comes very close to this goal. The method
relies on the fact that surveys are usually analyzed in redshift slices with a
sharp boundary at $\rmin$ and $\rmax$ away from the observer,
forming a spherical shell. The \textbf{exact} eigenvectors of a spherical shell
can be easily computed and expressed in terms of first and second kind spherical
Bessel functions. We can go one step further and enclose the observed angular
mask into a bounding spherical cap. We will show below that even the exact
eigenvectors for a spherical cap can also be easily computed and expressed in
terms of Legendre functions of the first and second kind. This results in a new
basis for Fourier decomposition that is similar to the spherical basis but has
fewer (less correlated) modes. The basis can be described by $k_n$ - a
wavenumber of a radial mode, and two orbital numbers $\widetilde{\ell}$ and
$\widetilde{m}$ that describe angular patterns. Unlike spherical Fourier
decomposition $ \widetilde{\ell}$ does not have to be an integer.

The basis we propose has a number of advantages, especially when describing
clustering on large scales. The radial modes are in fact exact and fully
uncorrelated. Since survey masks do not form a perfect spherical cap, the
angular modes are not exact but are closer to the ``true'' basis than the
conventional spherical harmonics decomposition. As a result the new basis has
fewer eigenvectors for the same range of scales that are much less correlated
because of the reduced redundancy.

The new basis is not computationally more expensive than the standard
decompositions and may be advantageous when analyzing large-scale structure on
large (compared to the size of the sample) scales such as the analysis of non-
Gaussianity in galaxy and weak lensing surveys, $\ldots$.

We will derive the basis in section~\ref{sec:basis} and will apply it to the
large-scale clustering of BOSS DR12 galaxies in section~\ref{sec:data} to
demonstrate that it indeed reduces the correlation of large-scale modes.
\section{Complete Basis for a spherical shell}
\label{sec:basis}

We will start by finding a complete basis for a field in a spherical shell
between $\rmin < r < \rmax$, for now assuming a full-sky
coverage. The most general solution of Laplace equation in spherical coordinates
is given by

\begin{align} 
\label{eq:generalsol}
f(r,\theta,\phi) = &\left[C_jj_\lambda(kr) + C_yy_\lambda(kr)\right]\times\\
\nonumber
&\left [C_pP^\mu_\lambda (\cos (\theta)) + C_qQ^\mu_\lambda(\cos
(\theta))\right]\times\\
\nonumber
&\left[C_+e^{i\mu\phi} + C_-e^ {-i\mu\phi}\right],
\end{align} 
\noindent
where $C$s are constants, $Q^\mu_\lambda$ and $P^\mu_\lambda$ are Legendre
functions of degree $\lambda$ and $\mu$. 

Let's start with the angular part. First of all, the function has to be $2\pi$
periodic in azimuthal angle $\phi$, which requires $\mu$ to be an integer $\mu =
m = 0, 1, 2, \ldots$. The functions also have to be finite for $-1 \leq
\cos(\theta) \leq 1$, which in addition requires that $\lambda$ is a positive
integer $\lambda = \ell = 0, 1, 2, \ldots$ and that $-\ell \leq m \leq \ell$.
For the angular part so far we have regular spherical harmonics.

We now want to select a subset of radial functions that satisfy necessary
boundary conditions at the edges of the spherical shell. Existing literature
seems to prefer Newman boundary condition prescribing zero normal derivatives at
these boundaries and we will follow this tradition, although in reality using
Dirichlet or mixed boundary conditions would not make a big practical difference
(except for a Gibb's phenomenon close to the boundary).\footnote{Periodic
boundary conditions do not make much sense for a radial coordinate.} This means
that we have to find a solution for a pair of equations

\begin{align}
\label{eq:bc1}
j'_\ell(k\rmin) + \frac{C_y}{C_j}y'_\ell(k\rmin) = 0,\\
\label{eq:bc2}
j'_\ell(k\rmax) + \frac{C_y}{C_j}y'_\ell(k\rmax) = 0. 
\end{align} 

\noindent 
This equation will only have a solution for specific discrete values of k and
the $C_y/C_j$ ratio. These pairs of values are easy to find numerically and can
be pre-tabulated for arbitrary index $\ell$, and the values of $\rmin$ and
$\rmax$. We will denote these solutions by $k_{\ell,n}$ and $A_{\ell,n} \equiv
C_y/C_j$ where n indexes the solutions of Eqs.~(\ref{eq:bc1}) and (
\ref{eq:bc2}). The new radial functions are then
\begin{equation} 
\mathcal{J}_{\ell,n} = j_\ell(k_{\ell,n}r) + A_{\ell,n}y_\ell(k_{\ell,n}r),
\end{equation}
\noindent
and we end up with a new basis

\begin{equation}
f_{n,\ell,m} \propto \mathcal{J}_{\ell,n}Y^m_\ell(\theta,\phi).
\end{equation}

Any function in a spherical shell can be decomposed into this basis by
\begin{equation}
F(r,\theta,\phi) = \displaystyle\sum_{n,\ell,m}a_{n,\ell,m}\mathcal{J}_
{\ell,n}Y^m_\ell(\theta,\phi),
\end{equation}
\noindent
where $a_{n,\ell,m}$ are the new Fourier coefficients. Real data is never given
on a full-sky and therefore the angular large-scale modes will still be
correlated by the mask, but purely radial modes are now uncorrelated.

\subsection{Reducing Angular Correlations}

\section{Conclusions}
\label{sec:conclusions}

\section*{Acknowledgements}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%% REFERENCES %%%%%%%%%%%%%%%%%%

% The best way to enter references is to use BibTeX:

%\bibliographystyle{mnras}
%\bibliography{example} % if your bibtex file is called example.bib



 % Alternatively you could enter them by hand, like this:
% This method is tedious and prone to error if you have lots of references
\begin{thebibliography}{99}
\end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


 %%%%%%
 %%%%%%%%%%% APPENDICES %%%%%%%%%%%%%%%%%%%%%

\appendix

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% Don't change these lines
\bsp	% typesetting comment
\label{lastpage}
\end{document}

% End of mnras_template.tex